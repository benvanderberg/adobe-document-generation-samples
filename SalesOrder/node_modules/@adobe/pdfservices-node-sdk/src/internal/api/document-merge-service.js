/*
 * Copyright 2019 Adobe
 * All Rights Reserved.
 *
 * NOTICE: Adobe permits you to use, modify, and distribute this file in
 * accordance with the terms of the Adobe license agreement accompanying
 * it. If you have received this file from a source other than Adobe,
 * then your use, modification, or distribution of it requires the prior
 * written permission of Adobe.
 */


const CpfOperationService = require('./cpf-operation-service'),
	CpfDocument = require('../cpf/request/platform/cpf-document.js'),
	ExtensionMediaTypeMapping = require('./../extension-mediatype-mapping'),
	CpfConfig = require('../config/cpf-engine-config.js'),
	CpfMessage = require('./../cpf/cpf-message');

class DocumentMergeService extends CpfOperationService {

	constructor() {
		super();
	}

	getCPFMessage(operationMessage) {
		let outputDocument = new CpfDocument(ExtensionMediaTypeMapping.getMediaTypeFromExtension(operationMessage.options.outputFormat),'file'),
			params = (operationMessage.options) ? Object.assign({},{
				outputFormat: operationMessage.options.outputFormat,
				jsonDataForMerge: operationMessage.options.jsonDataForMerge,
				fragments: operationMessage.options.fragments
			} ): {},
			inputDocuments = new CpfDocument(operationMessage.sourceFileRefs.input.mediaType, 'file0'),
			files = [operationMessage.sourceFileRefs];

		return new CpfMessage(inputDocuments, outputDocument, params, files, CpfConfig.mergeDocument);
	}
}

module.exports = DocumentMergeService;
